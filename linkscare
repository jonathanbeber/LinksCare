#!/usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import print_function

import argparse
import sys
from time import sleep
from datetime import datetime

try:
    from urllib.request import urlopen
except ImportError:
    from urllib import urlopen


parser = argparse.ArgumentParser(description='Monitora links')
parser.add_argument('url', metavar='URL',
                    help='URL para monitorar')
parser.add_argument('-n', dest='monit', action='store_false', default=True,
                    help='Não fica monitorando, verifica apenas uma vez')


def main():
    args = parser.parse_args()

    if not args.url.startswith('http'):
        print('A url não inicia com http:// ou https://')
        print('Adicionando, a url monitorada será:')
        args.url = 'http://' + args.url
        print(args.url)

    try:
        while True:
            verify_url(args.url)
            if not args.monit:
                sys.exit()
            sleep(10)
    except KeyboardInterrupt:
        print('Saindo :)')
        sys.exit(0)


def verify_url(url):
    date = datetime.today()
    try:
        code = urlopen(url).getcode()
        if code == 200:
            print('%s - Sucesso na conexão com o domínio' % date)
        else:
            print('%s - Falha na conexão com o domínio' % date)
    except:
        print('%s - Falha na conexão com o domínio' % date)

if __name__ == '__main__':
    main()
